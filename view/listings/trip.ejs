<% layout("/layout/boilerplate") -%>

<link href="https://fonts.googleapis.com/css2?family=Roboto&family=Playfair+Display&display=swap" rel="stylesheet">

<style>
  body { font-family: 'Roboto', sans-serif; background-color: #f8f9fa; }
  h1, h2, h3, h4, .section-heading { font-family: 'Playfair Display', serif; }
  .card-trip { border-radius: 1rem; overflow: hidden; transition: transform 0.2s; }
  .card-trip:hover { transform: scale(1.02); }
  .cover-photo { height: 250px; object-fit: cover; width: 100%; }
  .diary-text { white-space: pre-line; }
  .badge-place { background-color: crimson; color: white; margin-right: 5px; margin-bottom: 5px; }
</style>

<div class="container py-5">
  <h2 class="mb-4 text-center section-heading"><i class="fa-solid fa-map-location-dot me-2"></i>Your Trips</h2>

  <!-- NEW TRIP BUTTON -->
  <div class="text-center mb-4">
    <a href="/planTrip" class="btn btn-crimson btn-lg"><i class="fa-solid fa-plus me-2"></i>Plan New Trip</a>
  </div>

  <% if (trips && trips.length > 0) { %>
    <div class="row g-4">
      <% trips.forEach(trip => { %>
        <div class="col-md-6">
          <div class="card card-trip shadow-sm">
            
            <!-- Cover Photo -->
            <img src="<%= trip.photos && trip.photos.length > 0 ? trip.photos[0] : '/images/placeholder.jpg' %>" class="cover-photo" alt="Trip Cover">

            <div class="card-body">
              <h4 class="card-title"><i class="fa-solid fa-route me-1"></i> <%= trip.source %> â†’ <%= trip.destination %></h4>
              <small class="text-muted"><i class="fa-solid fa-calendar-days me-1"></i>
                <%= trip.startDate ? new Date(trip.startDate).toDateString() : "N/A" %> - 
                <%= trip.endDate ? new Date(trip.endDate).toDateString() : "N/A" %>
              </small>

              <!-- Places Visited -->
              <div class="mt-2">
                <% if (trip.places && trip.places.length > 0) { %>
                  <% trip.places.forEach(place => { %>
                    <span class="badge badge-place"><%= place %></span>
                  <% }) %>
                <% } %>
              </div>

              <!-- Diary / Experience -->
              <p class="mt-3 diary-text"><%= trip.diary %></p>

              <!-- Notes -->
              <% if (trip.notes) { %>
                <p class="mt-2"><strong>Notes:</strong> <%= trip.notes %></p>
              <% } %>

              <!-- Delete Trip -->
              <form action="/plans/<%= trip._id %>?_method=DELETE" method="POST" class="mt-3 text-end">
                <button class="btn btn-sm btn-outline-danger"><i class="fa-solid fa-trash"></i> Delete</button>
              </form>
            </div>
          </div>
        </div>
      <% }) %>
    </div>
  <% } else { %>
    <p class="text-center text-muted mt-5">You haven't planned any trips yet. Click "Plan New Trip" to start your travel diary!</p>
  <% } %>
</div>
